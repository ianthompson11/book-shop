<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ConfirmaciÃ³n de Pedido</title>

    <!-- Tailwind CSS CDN para estilos modernos -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">


    
    <!-- Incluye el menÃº de navegaciÃ³n -->
    {% include 'store/navbar.html' %}

    <!-- Contenedor principal -->
    <div class="max-w-4xl mx-auto px-4 py-10">
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">Resumen del Carrito ðŸ§¾</h1>

        <!-- Contenedor donde se mostrarÃ¡n los productos del carrito -->
        <div id="cart-container" class="space-y-4 bg-white p-6 rounded-lg shadow-md"></div>

        <!-- BotÃ³n para confirmar la orden -->
        <div class="text-center mt-8">
            <button id="realizar-compra"
                    class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded text-lg shadow">
                Realizar Pedido
            </button>
        </div>
    </div>

    <!-- Script para mostrar el contenido del carrito desde localStorage -->
    <script>
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        let total = 0;

        if (cart.length === 0) {
            document.getElementById("cart-container").innerHTML = `
                <p class="text-center text-gray-600">Tu carrito estÃ¡ vacÃ­o.</p>
            `;
        } else {
            cart.forEach(item => {
                const div = document.createElement('div');
                const itemTotal = item.quantity * item.price;
                total += itemTotal;

                // Tarjeta para cada producto
                div.className = "border-b pb-4";
                div.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-semibold text-lg text-gray-800">${item.name}</p>
                            <p class="text-gray-600 text-sm">${item.description}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-md">${item.quantity} x $${item.price.toFixed(2)}</p>
                            <p class="font-bold text-green-600">$${itemTotal.toFixed(2)}</p>
                        </div>
                    </div>
                `;
                document.getElementById("cart-container").appendChild(div);
            });

            // Mostrar total
            const totalDiv = document.createElement('div');
            totalDiv.className = "pt-6 text-right text-xl font-bold text-blue-700 border-t mt-6";
            totalDiv.innerHTML = `Total a pagar: $${total.toFixed(2)}`;
            document.getElementById("cart-container").appendChild(totalDiv);
        }
    </script>

    <!-- Script para enviar el carrito al backend -->
    <script>
        document.getElementById("realizar-compra").addEventListener("click", () => {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];

            fetch("/create-order/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ cart: cart })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert("Â¡Pedido realizado con Ã©xito! ID: " + data.order_id);
                    localStorage.removeItem("cart");
                    window.location.href = "/my-orders/";
                } else {
                    alert("Error: " + data.error);
                }
            });
        });
    </script>

</body>
</html>


